name: Putting it Together ðŸŽ¨

on:
  push:
    branches:
      - master

jobs:
  run:
    runs-on: ubuntu-latest
    strategy:
      max-parallel: 1
      matrix:
        exec:
          - 1
          - 2
          - 3
          - 4
          - 5
          - 6
    steps:
      - name: Checkout source ðŸ“¡
        uses: actions/checkout@v2
      - name: Cache Stack ðŸ“¦
        uses: actions/cache@v2
        with:
          path: ~/.stack
          key: ${{ runner.os }}-stack-${{ hashFiles('**/stack.yaml.lock') }}-${{ hashFiles('**/package.yaml') }}
          restore-keys: |
            ${{ runner.os }}-stack-${{ hashFiles('**/stack.yaml.lock') }}-
            ${{ runner.os }}-stack-
      - name: Install Stack ðŸ“¡
        uses: actions/setup-haskell@v1.1
        with:
          ghc-version: "8.10.2"
          cabal-version: "3.4.0.0"
          enable-stack: true
      - name: Build âš’
        run: stack build
      - name: Create .output directory ðŸ§¹
        run: mkdir .output
      - name: Run ðŸš€
        run: stack run ${{ matrix.exec }}
      - name: PPM to JPEG ðŸ–¼
        working-directory: ./.output
        run: |
          for i in *.ppm ; do
            [ -f "$i" ] || continue;
            mogrify -format jpg "$i";
          done
      - name: Deploy ðŸ§¾
        uses: JamesIves/github-pages-deploy-action@releases/v3
        with:
          ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          BRANCH: gh-pages
          FOLDER: .output
